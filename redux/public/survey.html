<!DOCTYPE html>
<html>
    <head>
        <title>FriendFinder - Survery Page</title>
        <script src="https://code.jquery.com/jquery.js"></script>
        <style>
            #modal-container {
                display: none;
                position: fixed;
                z-index: 2;
                width: 50%;
                height: 50%;
                left: 25%;
                bottom: 25%;
                border: black 2px solid;
                background-color: lightslategray;
            }


        </style>
    </head>
    <body>
        <h1>This is the survey page</h1>
        <form>
            <input type='text' id='name' placeholder="Enter your name"><br>
            <input type="text" id='image' placeholder="Please enter a link to your image"><br>
            <h3>How much do you like spicy food?</h3>
            <select id='spicy'>
                <option value='1'>1</option>
                <option value="2">2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
            </select>
            <h3>How much do you like playing sports?</h3>
            <select id='sports'>
                <option value='1'>1</option>
                <option value="2">2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
            </select>
            <h3>Do you like going to the movies?</h3>
            <select id='movies'>
                <option value='1'>1</option>
                <option value="2">2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
            </select>
            <h3>Do you read a lot?</h3>
            <select id='read'>
                <option value='1'>1</option>
                <option value="2">2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
            </select>
            <h3>Do you like pets</h3>
            <select id='pets'>
                <option value='1'>1</option>
                <option value="2">2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
            </select>
            <input id='button' type='submit'></input>
        </form>
        <div id='modal-container'>
            <div id='modal-content'>
                <p id='test'></p>
                <img id='profile-image' src="" height="100">
            </div>
        </div>
    </body>
    <script>
        var url = window.location.origin
        var current;
        $('#button').click((event)=>{
            event.preventDefault();
            var answers = {
                name: $("#name").val().trim(),
                image: $("#image").val().trim(),
                scores: [
                    $('#spicy').val(),
                    $('#sports').val(),
                    $('#movies').val(),
                    $('#read').val(),
                    $('#pets').val()
                ]
                // spicy: $("#spicy").val().trim(),
                // sports: $("#sports").val().trim(),
                // movies: $("#movies").val().trim(),
                // read: $("#read").val().trim(),
                // pets: $("#pets").val().trim()
            };
            $.post('/api-post', answers)
            .then((data)=>console.log(data))
            $.ajax({url: url + "/api", method: "GET"}).done((response)=>{
                console.log(response, answers.scores)
            function friendMatch(){
                var topFriend = 100;
                var friendName = [];
                var current = answers.scores;
                console.log(current)
                var curScore = 0;
                if(response.length<2){
                    alert('Not enough data in the system :/ Please try again')
                    return;
                }
                for(var p = 0; p <response.length - 1; p++){
                    for(var i = 0; i<response[p].scores.length; i++){
                        console.log('loop ran', response[p].scores[i])
                        if(response[p].scores[i]>answers.scores[i]){
                            curScore += response[p].scores[i] - answers.scores[i]
                        } else {
                            curScore += answers.scores[i] - response[p].scores[i]
                        }
                    }
                    if(curScore<topFriend){
                        friendName = [response[p].name,response[p].image];
                        console.log(response[p].image)
                        console.log(response[p])
                        topFriend = curScore;
                    }
                    console.log(`current score is ${curScore}`)
                    curScore = 0;
                }
                console.log('Jeb!')
                console.log(friendName)
                $('#profile-image').attr('src',friendName[1])
                $('#test').text(friendName[0])
                var test = $('#name').val()
                console.log(test)
                $('#modal-container').css('display','block')
            }
            friendMatch()
            })
        });

    </script>
</html>